<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å —Ç–µ—Å—Ç–∞ ‚Ä¢ –ê–¥–∞–ø—Ç–∏–≤</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* –°–ë–†–û–° + –ë–ê–ó–û–í–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Roboto, system-ui, -apple-system, sans-serif;
            background: #0b0e11;
            color: #eaecef;
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            -webkit-tap-highlight-color: transparent;
        }

        /* –ì–õ–ê–í–ù–´–ô –ö–û–ù–¢–ï–ô–ù–ï–† ‚Äî flex –Ω–∞ –ü–ö, column –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
        .admin-container {
            display: flex;
            width: 100%;
            min-height: 100vh;
        }

        /* ----- –ë–û–ö–û–í–ê–Ø –ü–ê–ù–ï–õ–¨ (–∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è) ----- */
        .sidebar {
            width: 350px;
            flex-shrink: 0;
            background: rgba(18, 22, 28, 0.98);
            border-right: 1px solid #2b3139;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow-y: auto;
            max-height: 100vh;
            position: sticky;
            top: 0;
        }

        .sidebar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #f0b90b, #f8d12f, #f0b90b);
            z-index: 2;
        }

        /* –∫–æ–Ω—Ç–µ–Ω—Ç —Å–∞–π–¥–±–∞—Ä–∞ */
        .sidebar-header {
            padding: 20px 18px;
            border-bottom: 1px solid #2b3139;
        }

        .sidebar-header h2 {
            color: #f0b90b;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
            background: linear-gradient(135deg, #f0b90b, #f8d12f);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .sidebar-header p {
            color: #b7bdc6;
            font-size: 13px;
        }

        .sidebar-stats {
            padding: 16px 18px;
            border-bottom: 1px solid #2b3139;
            background: rgba(43, 49, 57, 0.2);
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .stat-label {
            color: #b7bdc6;
        }

        .stat-value {
            color: #f0b90b;
            font-weight: 600;
        }

        /* —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ‚Äî grid –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö, –≤–Ω—É—Ç—Ä–∏ —Å–∫—Ä–æ–ª–ª */
        .users-list {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .user-card {
            background: rgba(43, 49, 57, 0.5);
            border: 1px solid #2b3139;
            border-radius: 16px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s;
            width: 100%;
        }

        .user-card:hover {
            background: rgba(59, 66, 76, 0.7);
            border-color: #f0b90b;
            transform: translateY(-1px);
        }

        .user-card.active {
            background: rgba(240, 185, 11, 0.18);
            border-color: #f0b90b;
            box-shadow: 0 0 0 1px #f0b90b, 0 6px 16px rgba(240, 185, 11, 0.15);
        }

        .user-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            gap: 8px;
        }

        .user-nickname {
            font-weight: 700;
            color: #eaecef;
            font-size: 16px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            flex: 1;
            min-width: 0;
        }

        .user-score {
            font-weight: 700;
            font-size: 18px;
            color: #f0b90b;
            flex-shrink: 0;
        }

        .user-score.correct { color: #27ae60; }
        .user-score.incorrect { color: #e74c3c; }

        .user-meta {
            display: flex;
            justify-content: space-between;
            font-size: 12.5px;
            color: #b7bdc6;
            flex-wrap: wrap;
            gap: 6px;
        }

        .user-status {
            padding: 4px 12px;
            border-radius: 24px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.4px;
            white-space: nowrap;
        }

        .status-completed { background: rgba(39, 174, 96, 0.15); color: #27ae60; border: 1px solid rgba(39, 174, 96, 0.3); }
        .status-in_progress { background: rgba(52, 152, 219, 0.15); color: #3498db; border: 1px solid rgba(52, 152, 219, 0.3); }
        .status-waiting { background: rgba(155, 89, 182, 0.15); color: #9b59b6; border: 1px solid rgba(155, 89, 182, 0.3); }
        .status-timeout { background: rgba(243, 156, 18, 0.15); color: #f39c12; border: 1px solid rgba(243, 156, 18, 0.3); }

        /* ----- –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ ----- */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
            background: rgba(11, 14, 17, 0.95);
            min-width: 0; /* –¥–ª—è flex-–¥–µ—Ç–µ–π */
        }

        .main-header {
            padding: 20px 22px;
            border-bottom: 1px solid #2b3139;
            background: rgba(18, 22, 28, 0.98);
            position: relative;
        }

        .main-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #f0b90b, #f8d12f, #f0b90b);
        }

        .main-header h1 {
            color: #f0b90b;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 12px;
            background: linear-gradient(135deg, #f0b90b, #f8d12f);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            word-break: break-word;
        }

        .user-details-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 8px;
            flex-wrap: wrap;
            gap: 16px;
        }

        .user-info {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
        }

        .user-detail {
            background: rgba(43, 49, 57, 0.6);
            padding: 6px 14px;
            border-radius: 30px;
            border: 1px solid #2b3139;
            font-size: 13.5px;
            white-space: nowrap;
        }

        .user-detail strong {
            color: #f0b90b;
            margin-right: 4px;
        }

        /* –û–ë–õ–ê–°–¢–¨ –û–¢–í–ï–¢–û–í ‚Äî –≥–ª–∞–≤–Ω–∞—è –∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è —á–∞—Å—Ç—å */
        .answers-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px 22px;
            background: #0b0e11;
        }

        .no-user-selected {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 70vh;
            color: #b7bdc6;
            text-align: center;
            padding: 30px 20px;
        }

        .no-user-selected .icon {
            font-size: 64px;
            margin-bottom: 20px;
            color: #f0b90b;
            opacity: 0.6;
        }

        .answers-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 16px;
        }

        .answers-header h2 {
            color: #f0b90b;
            font-size: 20px;
            font-weight: 600;
        }

        .answers-summary {
            background: rgba(43, 49, 57, 0.5);
            padding: 10px 24px;
            border-radius: 40px;
            border: 1px solid #2b3139;
            text-align: center;
        }

        .answers-summary .score {
            font-size: 26px;
            font-weight: 700;
            color: #f0b90b;
            line-height: 1.1;
        }

        .answers-summary .score-label {
            font-size: 12px;
            color: #b7bdc6;
        }

        /* –¢–ê–ë–õ–ò–¶–ê ‚Äî –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö –ø—Ä–µ–≤—Ä–∞—â–∞–µ–º –≤ –∫–∞—Ä—Ç–æ—á–∫–∏ */
        .answers-table {
            background: transparent;
            border-radius: 0;
            border: none;
            box-shadow: none;
            overflow: visible;
        }

        .answers-table table {
            width: 100%;
            border-collapse: collapse;
            display: table;
        }

        .answers-table thead {
            background: rgba(240, 185, 11, 0.1);
        }

        .answers-table th {
            padding: 18px 16px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
            color: #f0b90b;
            border-bottom: 1px solid #2b3139;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        .answers-table td {
            padding: 20px 16px;
            border-bottom: 1px solid #2b3139;
            font-size: 15px;
            color: #eaecef;
            vertical-align: top;
        }

        /* —Å—Ç–∏–ª–∏ –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤ (–æ–±—â–∏–µ) */
        .question-text {
            font-weight: 500;
            margin-bottom: 12px;
            line-height: 1.5;
            word-break: break-word;
        }

        .user-answer {
            background: rgba(43, 49, 57, 0.5);
            padding: 14px 16px;
            border-radius: 14px;
            border: 2px solid;
            margin-bottom: 8px;
            word-break: break-word;
        }

        .user-answer.correct { border-color: #27ae60; background: rgba(39, 174, 96, 0.1); }
        .user-answer.incorrect { border-color: #e74c3c; background: rgba(231, 76, 60, 0.1); }
        .user-answer.timeout { border-color: #f39c12; background: rgba(243, 156, 18, 0.1); font-style: italic; color: #f39c12; }

        .answer-info {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            color: #b7bdc6;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .answer-time { color: #f0b90b; font-weight: 600; }
        .answer-status { font-weight: 700; text-transform: uppercase; font-size: 12px; }
        .correct-status { color: #27ae60; }
        .incorrect-status { color: #e74c3c; }
        .timeout-status { color: #f39c12; }

        /* –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
        .control-panel {
            background: rgba(18, 22, 28, 0.98);
            padding: 18px 20px;
            border-top: 1px solid #2b3139;
        }

        .toggle-switch {
            display: flex;
            align-items: center;
            gap: 14px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 52px;
            height: 28px;
            flex-shrink: 0;
        }

        .switch input { opacity: 0; width: 0; height: 0; }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #2b3139;
            transition: .3s;
            border-radius: 28px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: #b7bdc6;
            transition: .3s;
            border-radius: 50%;
        }

        input:checked + .slider { background-color: #f0b90b; }
        input:checked + .slider:before { transform: translateX(24px); background-color: #0b0e11; }

        .toggle-label {
            font-size: 15px;
            font-weight: 600;
            color: #eaecef;
        }

        .toggle-status {
            padding: 6px 16px;
            border-radius: 30px;
            font-weight: 700;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        .status-active { background: rgba(240, 185, 11, 0.15); color: #f0b90b; border: 1px solid rgba(240, 185, 11, 0.3); }
        .status-inactive { background: rgba(255, 107, 107, 0.15); color: #ff6b6b; border: 1px solid rgba(255, 107, 107, 0.3); }

        .control-buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(135deg, #f0b90b 0%, #f8d12f 100%);
            color: #0b0e11;
            border: none;
            padding: 12px 24px;
            border-radius: 40px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 700;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            border: 1px solid transparent;
        }

        .btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(240, 185, 11, 0.3); }
        .btn:disabled { background: #2b3139; color: #5e6673; cursor: not-allowed; transform: none; box-shadow: none; border-color: #3a424b; }
        .btn-danger { background: linear-gradient(135deg, #e74c3c, #ff7979); }
        .btn-success { background: linear-gradient(135deg, #27ae60, #2ecc71); }
        .btn-secondary { background: #2b3139; color: #eaecef; }
        .btn-secondary:hover { background: #3a424b; }

        /* –ª–æ–∞–¥–µ—Ä */
        .loading { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 40px 20px; }
        .loader { width: 40px; height: 40px; border: 4px solid rgba(240,185,11,0.2); border-radius: 50%; border-top-color: #f0b90b; animation: spin 0.9s infinite linear; margin-bottom: 16px; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* —Å–∫—Ä—ã—Ç—ã–π –±–ª–æ–∫ –≤–æ–ø—Ä–æ—Å–æ–≤ */
        .questions-data { display: none; }

        /* ---------- –ú–û–ë–ò–õ–¨–ù–ê–Ø –ê–î–ê–ü–¢–ê–¶–ò–Ø (–ü–ï–†–ï–†–ê–ë–û–¢–ö–ê –¢–ê–ë–õ–ò–¶–´) ---------- */
        @media screen and (max-width: 900px) {
            .admin-container {
                flex-direction: column;
                height: auto;
                overflow: visible;
            }

            .sidebar {
                width: 100%;
                max-height: none;
                position: relative;
                border-right: none;
                border-bottom: 1px solid #2b3139;
                overflow-y: visible;
            }

            .users-list {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
                gap: 14px;
            }

            .user-card {
                margin-bottom: 0;
            }

            .main-content {
                width: 100%;
                overflow-x: hidden;
            }

            .main-header {
                padding: 18px;
            }

            .main-header h1 {
                font-size: 22px;
            }

            .user-details-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .user-info {
                width: 100%;
                gap: 10px;
            }

            .user-detail {
                white-space: normal;
                word-break: break-word;
                flex: 1 1 auto;
            }

            .answers-container {
                padding: 20px 16px;
            }

            .answers-header {
                flex-direction: column;
                align-items: stretch;
            }

            .answers-summary {
                align-self: flex-start;
                padding: 10px 24px;
            }

            /* –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ê–î–ê–ü–¢–ê–¶–ò–Ø –¢–ê–ë–õ–ò–¶–´ -> –ë–õ–û–ß–ù–ê–Ø –í–ï–†–°–¢–ö–ê */
            .answers-table table,
            .answers-table thead,
            .answers-table tbody,
            .answers-table th,
            .answers-table td,
            .answers-table tr {
                display: block;
            }

            .answers-table thead {
                display: none; /* —Å–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ –Ω–∞ –º–æ–± */
            }

            .answers-table tr {
                background: rgba(18, 22, 28, 0.95);
                border: 1px solid #2b3139;
                border-radius: 20px;
                margin-bottom: 20px;
                padding: 20px 18px;
                display: flex;
                flex-direction: column;
                gap: 16px;
            }

            .answers-table td {
                border: none;
                padding: 0;
                display: flex;
                flex-direction: column;
                border-bottom: none;
                width: 100% !important;
            }

            /* –í–∏–∑—É–∞–ª—å–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π */
            .answers-table td::before {
                content: attr(data-label);
                font-weight: 700;
                color: #f0b90b;
                text-transform: uppercase;
                font-size: 12px;
                letter-spacing: 0.8px;
                margin-bottom: 6px;
                display: block;
            }

            /* –¥–ª—è —è—á–µ–π–∫–∏ ‚Ññ –≤–æ–ø—Ä–æ—Å–∞ */
            .answers-table td:first-child {
                font-size: 20px;
                font-weight: 800;
                color: #f0b90b;
            }

            .answers-table td:first-child::before {
                content: "–í–û–ü–†–û–° ‚Ññ";
            }

            .answers-table td:nth-child(2)::before {
                content: "–¢–ï–ö–°–¢ –í–û–ü–†–û–°–ê –ò –û–¢–í–ï–¢";
            }

            .answers-table td:nth-child(3)::before {
                content: "–û–¢–í–ï–¢ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø";
                display: none; /* —Å–∫—Ä—ã–≤–∞–µ–º, —Ç–∫ –æ—Ç–≤–µ—Ç —É–∂–µ –≤–Ω—É—Ç—Ä–∏ user-answer, –Ω–æ –æ—Å—Ç–∞–≤–∏–º –¥–ª—è —è—Å–Ω–æ—Å—Ç–∏ */
            }

            .answers-table td:nth-child(4)::before {
                content: "–í–†–ï–ú–Ø";
            }

            .answers-table td:nth-child(5)::before {
                content: "–°–¢–ê–¢–£–°";
            }

            /* –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞, —á—Ç–æ–±—ã –Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–ª–æ—Å—å */
            .answers-table td .user-answer {
                margin-top: 6px;
                width: 100%;
            }

            .answers-table td .question-text {
                font-size: 16px;
                font-weight: 600;
                margin-bottom: 12px;
            }

            .answer-time, .answer-status {
                font-size: 13px;
            }

            /* —É–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –¥—É–±–ª–∏ –≤ –º–æ–± –≤–µ—Ä—Å–∏–∏ ‚Äî –∫–æ–ª–æ–Ω–∫–∞ "–æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" –¥—É–±–ª–∏—Ä—É–µ—Ç */
            .answers-table td:nth-child(3) {
                display: none;  /* —Å–∫—Ä—ã–≤–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω—É—é –∫–æ–ª–æ–Ω–∫—É —Å –æ—Ç–≤–µ—Ç–æ–º, —Ç–∞–∫ –∫–∞–∫ –æ–Ω —É–∂–µ –µ—Å—Ç—å –≤ –∫–æ–ª–æ–Ω–∫–µ –≤–æ–ø—Ä–æ—Å–∞ */
            }

            /* –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Ä–µ–º—è –∏ —Å—Ç–∞—Ç—É—Å –≤ –∫–æ–º–ø–∞–∫—Ç–Ω–æ–º –≤–∏–¥–µ */
            .answers-table td:nth-child(4),
            .answers-table td:nth-child(5) {
                display: flex;
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
                background: rgba(43, 49, 57, 0.3);
                padding: 10px 14px;
                border-radius: 40px;
                margin-top: 8px;
            }

            .answers-table td:nth-child(4)::before,
            .answers-table td:nth-child(5)::before {
                margin-bottom: 0;
                display: inline-block;
                width: auto;
            }

            .answers-table td .answer-time,
            .answers-table td .answer-status {
                font-size: 14px;
            }
        }

        /* –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏–µ —ç–∫—Ä–∞–Ω—ã */
        @media screen and (max-width: 480px) {
            .sidebar-header h2 { font-size: 22px; }
            .users-list { grid-template-columns: 1fr; }
            .user-card { padding: 16px; }
            .btn { width: 100%; justify-content: center; }
            .control-buttons { flex-direction: column; }
            .toggle-switch { justify-content: space-between; }
            .user-detail { font-size: 12.5px; white-space: normal; }
            .answers-summary { width: 100%; text-align: center; }
            .answers-table tr { padding: 18px; }
        }

        /* –¥–ª—è —Å—Ä–µ–¥–Ω–∏—Ö –ø–ª–∞–Ω—à–µ—Ç–æ–≤ */
        @media screen and (min-width: 901px) and (max-width: 1200px) {
            .sidebar { width: 300px; }
            .user-detail { white-space: nowrap; }
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å: —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>üìä –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
                <p>–°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ‚Ä¢ 15 –≤–æ–ø—Ä–æ—Å–æ–≤</p>
            </div>
            
            <div class="sidebar-stats">
                <div class="stat-row">
                    <span class="stat-label">–í—Å–µ–≥–æ –ø—Ä–æ—à–ª–∏:</span>
                    <span class="stat-value" id="total-users">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">–°—Ä–µ–¥–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</span>
                    <span class="stat-value" id="avg-score">0%</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã–π —Ç–µ—Å—Ç:</span>
                    <span class="stat-value" id="test-status-sidebar">–ù–µ—Ç</span>
                </div>
            </div>
            
            <div class="users-list" id="users-list">
                <!-- –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                <div class="loading">
                    <div class="loader"></div>
                    –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...
                </div>
            </div>
            
            <div class="control-panel">
                <div class="toggle-switch">
                    <label class="switch">
                        <input type="checkbox" id="test-toggle">
                        <span class="slider"></span>
                    </label>
                    <span class="toggle-label">–í–∫–ª—é—á–∏—Ç—å —Ç–µ—Å—Ç</span>
                    <span id="test-status" class="toggle-status status-inactive">–í–´–ö–õ</span>
                </div>
                
                <div class="control-buttons">
                    <button class="btn btn-success" onclick="exportToCSV()" id="export-btn" disabled>
                        üì• –≠–∫—Å–ø–æ—Ä—Ç CSV
                    </button>
                    <button class="btn btn-secondary" onclick="loadData()">
                        üîÑ –û–±–Ω–æ–≤–∏—Ç—å
                    </button>
                </div>
            </div>
        </div>
        
        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å: –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <div class="main-content">
            <div class="main-header">
                <h1 id="selected-user-name">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h1>
                <div class="user-details-header" id="user-details-header" style="display: none;">
                    <div class="user-info">
                        <div class="user-detail">
                            <strong>–†–µ–∑—É–ª—å—Ç–∞—Ç:</strong> <span id="user-result-score">0/15</span>
                        </div>
                        <div class="user-detail">
                            <strong>–í—Ä–µ–º—è:</strong> <span id="user-total-time">0 —Å–µ–∫</span>
                        </div>
                        <div class="user-detail">
                            <strong>–ü—Ä–æ—Ü–µ–Ω—Ç:</strong> <span id="user-percentage">0%</span>
                        </div>
                    </div>
                    <div class="user-detail">
                        <strong>–ó–∞–≤–µ—Ä—à–µ–Ω–æ:</strong> <span id="user-completed-at">‚Äî</span>
                    </div>
                </div>
            </div>
            
            <div class="answers-container" id="answers-container">
                <div class="no-user-selected" id="no-user-selected">
                    <div class="icon">üëà</div>
                    <h3>–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
                    <p>–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Å–ø–∏—Å–∫–∞ —Å–ª–µ–≤–∞, —á—Ç–æ–±—ã –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –µ–≥–æ –æ—Ç–≤–µ—Ç—ã</p>
                </div>
                
                <!-- –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ -->
                <div id="user-details" style="display: none;">
                    <div class="answers-header">
                        <h2>–û—Ç–≤–µ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
                        <div class="answers-summary">
                            <div class="score" id="user-score-display">0/15</div>
                            <div class="score-label">–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤</div>
                        </div>
                    </div>
                    
                    <div class="answers-table">
                        <table>
                            <thead>
                                <tr>
                                    <th style="width: 80px;">‚Ññ</th>
                                    <th>–í–æ–ø—Ä–æ—Å</th>
                                    <th>–û—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</th>
                                    <th style="width: 100px;">–í—Ä–µ–º—è</th>
                                    <th style="width: 120px;">–°—Ç–∞—Ç—É—Å</th>
                                </tr>
                            </thead>
                            <tbody id="answers-body">
                                <!-- –û—Ç–≤–µ—Ç—ã –±—É–¥—É—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è —á–µ—Ä–µ–∑ JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –°–∫—Ä—ã—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å–æ–≤ (–Ω–µ –º–µ–Ω—è–µ–º) -->
    <div class="questions-data" id="questions-data"></div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Supabase (–ü–û–õ–ù–û–°–¢–¨–Æ –°–û–•–†–ê–ù–ï–ù–ê)
        const SUPABASE_URL = 'https://wkukgnkfbxgpvlraczeu.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_11WBFNEcbspv1yDyfxq7sQ_Nl51ew5i';
        
        const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        
        const QUESTIONS = [
            { number: 1, text: "–ê–Ω–∞–ª–∏—Ç–∏–∫ - —ç—Ç–æ:", options: { option1: "–î—Ä—É–≥ –¥–µ–≤—É—à–∫–∏, –∫–æ—Ç–æ—Ä—ã–π —Ö–æ—Ä–æ—à–æ —Ä–∞–∑–±–∏—Ä–∞–µ—Ç—Å—è –≤ –∫—Ä–∏–ø—Ç–µ –∏ –≤–µ–¥–µ—Ç –∑–∞–∫—Ä—ã—Ç—ã–π –∫–∞–Ω–∞–ª —Å —Å–∏–≥–Ω–∞–ª–∞–º–∏", option2: "–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∞–Ω–∞–ª–∏—Ç–∏–∫, —Ä–∞–±–æ—Ç–∞—é—â–∏–π –≤ –∫—Ä—É–ø–Ω–æ–π –∫–æ–º–ø–∞–Ω–∏–∏, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –¥–∞–µ—Ç —Å–∏–≥–Ω–∞–ª—ã –Ω–∏–∫–æ–º—É, –∫—Ä–æ–º–µ –¥–µ–≤—É—à–∫–∏ –∏ –µ–µ –æ—Ç—Ü–∞" }, correct: "option2" },
            { number: 2, text: "–ö–æ–≥–æ –≤—ã –≤–æ–∑—å–º—ë—Ç–µ –≤ —Ä–∞–±–æ—Ç—É?", options: { option1: "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä, 31 –≥–æ–¥, –≥—Ä–∞–∂–¥–∞–Ω—Å—Ç–≤–æ –†–§, —Ä–æ–¥–∏–ª—Å—è –≤ –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥–µ, —Ä–∞–±–æ—Ç–∞–µ—Ç –∫—É—Ä—å–µ—Ä–æ–º –≤ Ozon", option2: "–ù–∞–∏–ª—å, 29 –ª–µ—Ç, –≥—Ä–∞–∂–¥–∞–Ω—Å—Ç–≤–æ –†–§, —Ä–æ–¥–∏–ª—Å—è –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ, –æ–ø—ã—Ç–Ω—ã–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –≤ —Å—Ñ–µ—Ä–µ –ø—Ä–æ–¥–∞–∂, —Ö–æ—Ä–æ—à–æ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç", option3: "–ù–∏–∫–æ–≥–æ" }, correct: "option1" },
            { number: 3, text: "–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä–Ω—ã–π –≤–±—Ä–æ—Å –¥–µ–ª–∞–µ—Ç—Å—è —Å —Ü–µ–ª—å—é:", options: { option1: "–£–≤–∏–¥–µ—Ç—å —Ä–µ–∞–∫—Ü–∏—é –∫–ª–∏–µ–Ω—Ç–∞ –Ω–∞ —Ç–æ—Ç —Ñ–∞–∫—Ç, —á—Ç–æ –¥–µ–≤—É—à–∫–∞ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–∞ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è—Ö", option2: "–†–∞—Å—Å–∫–∞–∑–∞—Ç—å –∫–ª–∏–µ–Ω—Ç—É, –∫–∞–∫ –¥–µ–≤—É—à–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–º, —á—Ç–æ–±—ã —É –∫–ª–∏–µ–Ω—Ç–∞ –±—ã–ª–æ –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Å—Ñ–µ—Ä—ã –Ω–∞ –º–æ–º–µ–Ω—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è" }, correct: "option1" },
            { number: 4, text: "–°–∫–æ–ª—å–∫–æ –≤–±—Ä–æ—Å–æ–≤ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–∞ –≤–µ—Å—å –¥–∏–∞–ª–æ–≥?", options: { option1: "2-3 –≤–±—Ä–æ—Å–∞", option2: "1 –≤–±—Ä–æ—Å", option3: "4-6 –≤–±—Ä–æ—Å–æ–≤" }, correct: "option1" },
            { number: 5, text: "–û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ '–ø—Ä–æ–≥—Ä–µ–≤–æ–≤' –¥–æ –º–æ–º–µ–Ω—Ç–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è:", options: { option1: "3 —Ä–∞–∑–∞", option2: "1-2 —Ä–∞–∑–∞", option3: "5 –∏ –±–æ–ª–µ–µ —Ä–∞–∑" }, correct: "option1" },
            { number: 6, text: "–í–æ–∑—å–º–µ—Ç–µ –ª–∏ –≤—ã –∫–ª–∏–µ–Ω—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π —Å–∏–¥–∏—Ç –Ω–∞ —Å–∞–π—Ç–µ –∑–Ω–∞–∫–æ–º—Å—Ç–≤ –±–æ–ª—å—à–µ –º–µ—Å—è—Ü–∞, –Ω–æ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –µ–º—É –µ—â–µ –Ω–µ –ø—Ä–µ–¥–ª–∞–≥–∞–ª–∏?", options: { option1: "–î–∞", option2: "–ù–µ—Ç" }, correct: "option2" },
            { number: 7, text: "–ö–æ–≥–¥–∞ –¥–µ–ª–∞–µ—Ç—Å—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–Ω—ã–π –≤–±—Ä–æ—Å?", options: { option1: "–ù–∞ –≤—Ç–æ—Ä–æ–π –¥–µ–Ω—å –æ–±—â–µ–Ω–∏—è", option2: "–í –ø–µ—Ä–≤—ã–π –¥–µ–Ω—å –æ–±—â–µ–Ω–∏—è, –≤ –ø–µ—Ä–≤—ã–µ 2 —á–∞—Å–∞ –≤–µ–¥–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞", option3: "–ü–æ—Å–ª–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è" }, correct: "option2" },
            { number: 8, text: "–ú–æ–∂–Ω–æ –ª–∏ –ø–µ—Ä–µ–¥–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ —Å —Ö–æ—Ä–æ—à–µ–π –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞—Ä–ø–ª–∞—Ç–æ–π, –Ω–æ —Å –ø—Ä–æ—Å—Ä–æ—á–∫–∞–º–∏ –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º?", options: { option1: "–î–∞", option2: "–ù–µ—Ç" }, correct: "option2" },
            { number: 9, text: "–ö–ª–∏–µ–Ω—Ç—É –±—É–¥–µ—Ç 23 –≥–æ–¥–∞ —á–µ—Ä–µ–∑ –¥–≤–µ –Ω–µ–¥–µ–ª–∏, –≤–æ–∑—å–º—ë—Ç–µ –ª–∏ –≤—ã –µ–≥–æ –≤ —Ä–∞–±–æ—Ç—É?", options: { option1: "–î–∞", option2: "–ù–µ—Ç" }, correct: "option2" },
            { number: 10, text: "–ö–æ–≥–¥–∞ –≤—ã —É–∑–Ω–∞–≤–∞–ª–∏ —É –∫–ª–∏–µ–Ω—Ç–∞ —á—Ç–æ –µ–º—É –ø—Ä–µ–¥–ª–∞–≥–∞–ª–∏, –æ–Ω —Å–∫–∞–∑–∞–ª —á—Ç–æ –µ–º—É –ø–∏—Å–∞–ª–æ –º–Ω–æ–≥–æ —Ñ–µ–π–∫–æ–≤ —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º–∏ –ø–æ—Ä–∞–±–æ—Ç–∞—Ç—å –∏ –∫—É–ø–∏—Ç—å –∏–Ω—Ç–∏–º–Ω—ã–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏. –í–æ–∑—å–º—ë—Ç–µ –ª–∏ –≤—ã —Ç–∞–∫–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –≤ —Ä–∞–±–æ—Ç—É?", options: { option1: "–î–∞", option2: "–ù–µ—Ç" }, correct: "option1" },
            { number: 11, text: "–ö–ª–∏–µ–Ω—Ç —Ä–∞–Ω—å—à–µ –∑–∞–Ω–∏–º–∞–ª—Å—è –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è–º–∏, –Ω–æ –≥–æ–¥ –Ω–∞–∑–∞–¥ –≤—Å–µ –ø–æ—Ç–µ—Ä—è–ª. –ß—Ç–æ –≤—ã —Å–¥–µ–ª–∞–µ—Ç–µ —Å —Ç–∞–∫–∏–º –∫–ª–∏–µ–Ω—Ç–æ–º?", options: { option1: "–í–æ–∑—å–º–µ—Ç–µ –≤ —Ä–∞–±–æ—Ç—É –ø–æ—Å–∫–æ–ª—å–∫—É —ç—Ç–æ —Ö–æ—Ä–æ—à–∏–π –∫–ª–∏–µ–Ω—Ç —É–∂–µ —Å –∏–Ω—Ç–µ—Ä–µ—Å–æ–º –∫ —Å—Ñ–µ—Ä–µ", option2: "–ü—Ä–æ–∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä—É–µ—Ç–µ—Å—å —Å —Ç–∏–º–ª–∏–¥–µ—Ä–æ–º", option3: "–ê—Ä—Ö–∏–≤, –ø–æ—Å–∫–æ–ª—å–∫—É —É –∫–ª–∏–µ–Ω—Ç–∞ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–π –æ–ø—ã—Ç —Å –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è–º–∏" }, correct: "option2" },
            { number: 12, text: "–ö–∞–∫–∞—è —Ü–µ–ª—å –ø—Ä–æ–≥—Ä–µ–≤–∞?", options: { option1: "–°–æ–∑–¥–∞—Ç—å —É –∫–ª–∏–µ–Ω—Ç–∞ –∏–Ω—Ç–µ—Ä–µ—Å –∫ —Ä–∞–∑–≤–∏—Ç–∏—é –∏ —É–≤–µ–ª–∏—á–µ–Ω–∏—é –¥–æ—Ö–æ–¥–∞", option2: "–†–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø–ª—é—Å—ã —Å—Ñ–µ—Ä—ã –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π", option3: "–†–∞—Å—Å–∫–∞–∑–∞—Ç—å –∫–∞–∫ –¥–µ–≤–æ—á–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–º" }, correct: "option1" },
            { number: 13, text: "–ö–ª–∏–µ–Ω—Ç –≤ —Å–∞–º–æ–º –Ω–∞—á–∞–ª–µ –æ–±—â–µ–Ω–∏—è 5-–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º –ø—Ä–æ—Å–∏—Ç —Å–∫–∏–Ω—É—Ç—å —Ñ–æ—Ç–∫–∏. –í–∞—à–∏ –¥–µ–π—Å—Ç–≤–∏—è?", options: { option1: "–°–∫–∏–Ω–µ—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏", option2: "–°–∫–∞–∂–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç—É —á—Ç–æ –æ–Ω –ø–µ—Ä–µ–≥–∏–±–∞–µ—Ç –ø–∞–ª–∫—É –∏ –≤—ã –Ω–µ —Å–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å –∫–∏–¥–∞—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –Ω–µ –∑–Ω–∞–∫–æ–º–æ–º—É —á–µ–ª–æ–≤–µ–∫—É", option3: "–ú—è–≥–∫–æ –æ—Ç–∫–∞–∂–µ—Ç–µ, –ø–æ—Å–ª–µ —á–µ–≥–æ –≤ —Ç–µ—á–µ–Ω–∏–∏ 30-60 –º–∏–Ω —Å–∞–º–∏ —Å–∫–∏–Ω–µ—Ç–µ –∫–ª–∏–µ–Ω—Ç—É –∫—Ä—É–∂–æ—á–µ–∫ –±–µ–∑ –µ–≥–æ –ø—Ä–æ—Å—å–±—ã" }, correct: "option3" },
            { number: 14, text: "–í —Å–∞–º–æ–º –Ω–∞—á–∞–ª–µ –æ–±—â–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç –ø—Ä–æ—Å–∏—Ç —Å–∫–∏–Ω—É—Ç—å –∫—Ä—É–∂–µ–∫ —á—Ç–æ –±—ã —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –¥–µ–≤–æ—á–∫–∞ –Ω–µ —Ñ–µ–π–∫. –í–∞—à–∏ –¥–µ–π—Å—Ç–≤–∏—è?", options: { option1: "–°–∫–∏–Ω–µ—Ç–µ –∫—Ä—É–∂–µ—á–µ–∫, —Ç–µ–º —Å–∞–º—ã–º –æ—Ç—Å–µ–µ—Ç–µ —É –Ω–µ–≥–æ –≤—Å–µ —Å–æ–º–Ω–µ–Ω–∏—è –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ –æ–±—â–µ–Ω–∏–µ", option2: "–í—ã–∫–∏–Ω–µ—Ç–µ –≤ –∞—Ä—Ö–∏–≤" }, correct: "option2" },
            { number: 15, text: "–í—ã–±–µ—Ä–µ—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ", options: { option1: "–ê–Ω–∞–ª–∏—Ç–∏–∫ –Ω–∞–±–∏—Ä–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ –∏ –≤–æ–∑—å–º–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞ –µ—Å–ª–∏ —É –Ω–µ–≥–æ –±—É–¥–µ—Ç –∂–µ–ª–∞–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–∞—Ç—å –∏ —Ö–æ—Ä–æ—à–∏–π –∫–∞–ø–∏—Ç–∞–ª", option2: "–ê–Ω–∞–ª–∏—Ç–∏–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–∞—Å—Ç–Ω—ã–º —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–º –≤ –±–æ–ª—å—à–æ–π –∫–æ–º–ø–∞–Ω–∏–∏ –∏ –≤–æ–∑—å–º–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞ –≤ –ø–∞—Ä—Ç–Ω–µ—Ä—ã —Ä–∞–¥–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –ø–æ—Ç–æ–º—É —á—Ç–æ –∑–∞ –Ω–µ–≥–æ –ø–æ–ø—Ä–æ—Å–∏–ª–∞ –¥–µ–≤–æ—á–∫–∞" }, correct: "option2" }
        ];
        
        let allUsers = [];
        let selectedUser = null;
        let realtimeSubscription = null;
        
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
            await loadData();
            await loadSettings();
            setupRealtime();
        });
        
        async function loadData() {
            console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...');
            showLoading(true);
            try {
                const { data: users, error } = await supabaseClient
                    .from('test_sessions')
                    .select('*')
                    .order('created_at', { ascending: false });
                if (error) throw error;
                allUsers = users || [];
                updateStats();
                renderUsersList();
                showLoading(false);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ' + error.message);
            }
        }
        
        async function loadSettings() {
            try {
                const { data: settings, error } = await supabaseClient
                    .from('test_settings')
                    .select('*')
                    .single();
                if (error) throw error;
                const toggle = document.getElementById('test-toggle');
                const statusSpan = document.getElementById('test-status');
                const sidebarStatus = document.getElementById('test-status-sidebar');
                toggle.checked = settings.is_active;
                if (settings.is_active) {
                    statusSpan.textContent = '–í–ö–õ';
                    statusSpan.className = 'toggle-status status-active';
                    sidebarStatus.textContent = '–î–∞';
                } else {
                    statusSpan.textContent = '–í–´–ö–õ';
                    statusSpan.className = 'toggle-status status-inactive';
                    sidebarStatus.textContent = '–ù–µ—Ç';
                }
                toggle.removeEventListener('change', toggleHandler);
                toggle.addEventListener('change', toggleHandler);
                async function toggleHandler() {
                    const newStatus = toggle.checked;
                    const { error } = await supabaseClient
                        .from('test_settings')
                        .update({ is_active: newStatus })
                        .eq('id', 1);
                    if (error) {
                        alert('–û—à–∏–±–∫–∞: ' + error.message);
                        toggle.checked = !newStatus;
                    } else {
                        statusSpan.textContent = newStatus ? '–í–ö–õ' : '–í–´–ö–õ';
                        statusSpan.className = newStatus ? 'toggle-status status-active' : 'toggle-status status-inactive';
                        sidebarStatus.textContent = newStatus ? '–î–∞' : '–ù–µ—Ç';
                    }
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫:', error);
            }
        }
        
        function setupRealtime() {
            if (realtimeSubscription) supabaseClient.removeChannel(realtimeSubscription);
            realtimeSubscription = supabaseClient
                .channel('test_results_changes')
                .on('postgres_changes', { event: '*', schema: 'public', table: 'test_sessions' }, payload => loadData())
                .on('postgres_changes', { event: '*', schema: 'public', table: 'test_settings' }, payload => loadSettings())
                .subscribe();
        }
        
        function updateStats() {
            document.getElementById('total-users').textContent = allUsers.length;
            const completedUsers = allUsers.filter(u => u.status === 'completed');
            if (completedUsers.length > 0) {
                const avgCorrect = completedUsers.reduce((sum, u) => sum + (u.total_correct || 0), 0) / completedUsers.length;
                document.getElementById('avg-score').textContent = Math.round((avgCorrect / 15) * 100) + '%';
            } else {
                document.getElementById('avg-score').textContent = '0%';
            }
            document.getElementById('export-btn').disabled = allUsers.length === 0;
        }
        
        function renderUsersList() {
            const usersList = document.getElementById('users-list');
            if (allUsers.length === 0) {
                usersList.innerHTML = `<div class="no-user-selected" style="height: auto;"><div class="icon">üì≠</div><h3>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</h3><p>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –µ—â–µ –Ω–µ –ø—Ä–æ—à–ª–∏ —Ç–µ—Å—Ç</p></div>`;
                return;
            }
            let html = '';
            allUsers.forEach(user => {
                const totalCorrect = user.total_correct || 0;
                const percentage = Math.round((totalCorrect / 15) * 100);
                const isActive = selectedUser && selectedUser.id === user.id;
                let scoreClass = '';
                if (percentage >= 75) scoreClass = 'correct';
                else if (percentage >= 50) scoreClass = '';
                else scoreClass = 'incorrect';
                const date = new Date(user.created_at);
                const dateString = date.toLocaleDateString('ru-RU');
                const timeString = date.toLocaleTimeString('ru-RU').slice(0,5);
                html += `<div class="user-card ${isActive ? 'active' : ''}" onclick="selectUser('${user.id}')" id="user-card-${user.id}">
                            <div class="user-header">
                                <div class="user-nickname" title="${user.telegram_nickname || '–ë–µ–∑ –∏–º–µ–Ω–∏'}">${user.telegram_nickname || '–ë–µ–∑ –∏–º–µ–Ω–∏'}</div>
                                <div class="user-score ${scoreClass}">${totalCorrect}/15</div>
                            </div>
                            <div class="user-meta">
                                <div>${dateString} ${timeString}</div>
                                <div class="user-status status-${user.status || 'completed'}">${getStatusText(user.status)}</div>
                            </div>
                        </div>`;
            });
            usersList.innerHTML = html;
        }
        
        function selectUser(userId) {
            const user = allUsers.find(u => u.id === userId);
            if (!user) return;
            selectedUser = user;
            document.querySelectorAll('.user-card').forEach(c => c.classList.remove('active'));
            const activeCard = document.getElementById(`user-card-${userId}`);
            if (activeCard) activeCard.classList.add('active');
            showUserDetails(user);
        }
        
        function showUserDetails(user) {
            document.getElementById('selected-user-name').textContent = `–û—Ç–≤–µ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${user.telegram_nickname || '–ë–µ–∑ –∏–º–µ–Ω–∏'}`;
            document.getElementById('user-details-header').style.display = 'flex';
            document.getElementById('no-user-selected').style.display = 'none';
            document.getElementById('user-details').style.display = 'block';
            
            const totalCorrect = user.total_correct || 0;
            const percentage = Math.round((totalCorrect / 15) * 100);
            const totalTime = user.total_time_spent || 0;
            
            document.getElementById('user-result-score').textContent = `${totalCorrect}/15`;
            document.getElementById('user-total-time').textContent = `${totalTime} —Å–µ–∫`;
            document.getElementById('user-percentage').textContent = `${percentage}%`;
            document.getElementById('user-score-display').textContent = `${totalCorrect}/15`;
            
            let completedAt = '‚Äî';
            if (user.completed_at) {
                const date = new Date(user.completed_at);
                completedAt = date.toLocaleDateString('ru-RU') + ' ' + date.toLocaleTimeString('ru-RU').slice(0,5);
            }
            document.getElementById('user-completed-at').textContent = completedAt;
            renderUserAnswers(user);
        }
        
        function renderUserAnswers(user) {
            const answersBody = document.getElementById('answers-body');
            let html = '';
            for (let i = 1; i <= 15; i++) {
                const question = QUESTIONS[i - 1];
                const answerKey = user[`q${i}_answer`];
                const isCorrect = user[`q${i}_is_correct`];
                const timeSpent = user[`q${i}_time_spent`] || 0;
                
                let answerText = '–ù–µ—Ç –æ—Ç–≤–µ—Ç–∞';
                let answerClass = 'timeout';
                let statusText = '–¢–∞–π–º–∞—É—Ç';
                let statusClass = 'timeout-status';
                
                if (answerKey && answerKey !== 'null') {
                    answerText = question.options[answerKey] || answerKey;
                    answerClass = isCorrect ? 'correct' : 'incorrect';
                    statusText = isCorrect ? '–ü—Ä–∞–≤–∏–ª—å–Ω–æ' : '–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ';
                    statusClass = isCorrect ? 'correct-status' : 'incorrect-status';
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º data-label –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–π –∞–¥–∞–ø—Ç–∞—Ü–∏–∏
                html += `<tr>
                            <td data-label="–í–û–ü–†–û–° ‚Ññ" class="question-number">${question.number}</td>
                            <td data-label="–¢–ï–ö–°–¢ –í–û–ü–†–û–°–ê –ò –û–¢–í–ï–¢">
                                <div class="question-text">${question.text}</div>
                                <div class="user-answer ${answerClass}">
                                    ${answerText}
                                    <div class="answer-info">
                                        <span class="answer-time">${timeSpent} —Å–µ–∫</span>
                                        <span class="answer-status ${statusClass}">${statusText}</span>
                                    </div>
                                </div>
                            </td>
                            <td data-label="–û–¢–í–ï–¢ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø">${answerText}</td>
                            <td data-label="–í–†–ï–ú–Ø"><span class="answer-time">${timeSpent} —Å–µ–∫</span></td>
                            <td data-label="–°–¢–ê–¢–£–°"><span class="answer-status ${statusClass}">${statusText}</span></td>
                        </tr>`;
            }
            answersBody.innerHTML = html;
        }
        
        function getStatusText(status) {
            const map = { 'completed': '–ó–∞–≤–µ—Ä—à–µ–Ω', 'in_progress': '–í –ø—Ä–æ—Ü–µ—Å—Å–µ', 'waiting': '–û–∂–∏–¥–∞–Ω–∏–µ', 'timeout': '–¢–∞–π–º–∞—É—Ç' };
            return map[status] || '–ó–∞–≤–µ—Ä—à–µ–Ω';
        }
        
        function exportToCSV() {
            if (allUsers.length === 0) { alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞'); return; }
            const headers = ['ID','Telegram –Ω–∏–∫','–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞','–í—Å–µ–≥–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö','–ü—Ä–æ—Ü–µ–Ω—Ç','–û–±—â–µ–µ –≤—Ä–µ–º—è','–°—Ç–∞—Ç—É—Å'];
            const csvRows = [headers.join(',')];
            allUsers.forEach(user => {
                const totalCorrect = user.total_correct || 0;
                const percentage = Math.round((totalCorrect / 15) * 100);
                const row = [
                    user.id,
                    `"${user.telegram_nickname || ''}"`,
                    user.created_at,
                    totalCorrect,
                    percentage + '%',
                    user.total_time_spent || 0,
                    user.status
                ];
                csvRows.push(row.join(','));
            });
            const csvString = csvRows.join('\n');
            const blob = new Blob([csvString], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `test_results_${new Date().toISOString().split('T')[0]}_${allUsers.length}_users.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        function showLoading(show) {
            const usersList = document.getElementById('users-list');
            if (show) {
                usersList.innerHTML = `<div class="loading" style="height:200px;"><div class="loader"></div>–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...</div>`;
            }
        }
        
        function showError(message) {
            const usersList = document.getElementById('users-list');
            usersList.innerHTML = `<div style="margin:20px; padding:20px; border-radius:12px; background:rgba(231,76,60,0.1); border:1px solid rgba(231,76,60,0.3); color:#e74c3c;"><strong>–û—à–∏–±–∫–∞:</strong> ${message}<br><br><button onclick="loadData()" class="btn btn-secondary" style="padding:8px 16px;">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É</button></div>`;
        }
        
        window.exportToCSV = exportToCSV;
        window.loadData = loadData;
        window.selectUser = selectUser;
    </script>
</body>
</html>
