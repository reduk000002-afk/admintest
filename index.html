<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å —Ç–µ—Å—Ç–∞</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: #0b0e11;
            color: #eaecef;
            min-height: 100vh;
        }
        
        .admin-container {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }
        
        /* –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ */
        .sidebar {
            width: 350px;
            background: rgba(18, 22, 28, 0.95);
            border-right: 1px solid #2b3139;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }
        
        .sidebar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #f0b90b, #f8d12f, #f0b90b);
        }
        
        .sidebar-header {
            padding: 25px;
            border-bottom: 1px solid #2b3139;
        }
        
        .sidebar-header h2 {
            color: #f0b90b;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
            background: linear-gradient(135deg, #f0b90b 0%, #f8d12f 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .sidebar-header p {
            color: #b7bdc6;
            font-size: 14px;
        }
        
        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ —Å–∞–π–¥–±–∞—Ä–µ */
        .sidebar-stats {
            padding: 20px 25px;
            border-bottom: 1px solid #2b3139;
            background: rgba(43, 49, 57, 0.3);
        }
        
        .stat-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-size: 14px;
        }
        
        .stat-row:last-child {
            margin-bottom: 0;
        }
        
        .stat-label {
            color: #b7bdc6;
        }
        
        .stat-value {
            color: #f0b90b;
            font-weight: 600;
        }
        
        /* –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π */
        .users-list {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }
        
        .user-card {
            background: rgba(43, 49, 57, 0.5);
            border: 1px solid #2b3139;
            border-radius: 12px;
            padding: 18px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .user-card:hover {
            background: rgba(59, 66, 76, 0.7);
            border-color: #f0b90b;
            transform: translateY(-2px);
        }
        
        .user-card.active {
            background: rgba(240, 185, 11, 0.15);
            border-color: #f0b90b;
            box-shadow: 0 0 0 1px #f0b90b, 0 8px 20px rgba(240, 185, 11, 0.1);
        }
        
        .user-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .user-nickname {
            font-weight: 700;
            color: #eaecef;
            font-size: 16px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 200px;
        }
        
        .user-score {
            font-weight: 700;
            font-size: 18px;
            color: #f0b90b;
        }
        
        .user-score.correct {
            color: #27ae60;
        }
        
        .user-score.incorrect {
            color: #e74c3c;
        }
        
        .user-meta {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            color: #b7bdc6;
        }
        
        .user-status {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-completed {
            background: rgba(39, 174, 96, 0.15);
            color: #27ae60;
            border: 1px solid rgba(39, 174, 96, 0.3);
        }
        
        .status-in_progress {
            background: rgba(52, 152, 219, 0.15);
            color: #3498db;
            border: 1px solid rgba(52, 152, 219, 0.3);
        }
        
        .status-waiting {
            background: rgba(155, 89, 182, 0.15);
            color: #9b59b6;
            border: 1px solid rgba(155, 89, 182, 0.3);
        }
        
        .status-timeout {
            background: rgba(243, 156, 18, 0.15);
            color: #f39c12;
            border: 1px solid rgba(243, 156, 18, 0.3);
        }
        
        /* –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .main-header {
            padding: 25px 30px;
            border-bottom: 1px solid #2b3139;
            background: rgba(18, 22, 28, 0.95);
            position: relative;
        }
        
        .main-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #f0b90b, #f8d12f, #f0b90b);
        }
        
        .main-header h1 {
            color: #f0b90b;
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #f0b90b 0%, #f8d12f 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .user-details-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }
        
        .user-info {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        
        .user-detail {
            background: rgba(43, 49, 57, 0.5);
            padding: 8px 16px;
            border-radius: 20px;
            border: 1px solid #2b3139;
            font-size: 14px;
        }
        
        .user-detail strong {
            color: #f0b90b;
            margin-right: 5px;
        }
        
        /* –û–±–ª–∞—Å—Ç—å —Å –æ—Ç–≤–µ—Ç–∞–º–∏ */
        .answers-container {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
            background: rgba(11, 14, 17, 0.7);
        }
        
        .answers-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .answers-header h2 {
            color: #f0b90b;
            font-size: 22px;
            font-weight: 600;
        }
        
        .answers-summary {
            background: rgba(43, 49, 57, 0.5);
            padding: 12px 20px;
            border-radius: 12px;
            border: 1px solid #2b3139;
        }
        
        .answers-summary .score {
            font-size: 24px;
            font-weight: 700;
            color: #f0b90b;
            text-align: center;
        }
        
        .answers-summary .score-label {
            font-size: 14px;
            color: #b7bdc6;
            text-align: center;
        }
        
        /* –¢–∞–±–ª–∏—Ü–∞ –æ—Ç–≤–µ—Ç–æ–≤ */
        .answers-table {
            background: rgba(18, 22, 28, 0.95);
            border-radius: 16px;
            border: 1px solid #2b3139;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .answers-table table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .answers-table thead {
            background: rgba(240, 185, 11, 0.1);
        }
        
        .answers-table th {
            padding: 20px;
            text-align: left;
            font-weight: 600;
            font-size: 15px;
            color: #f0b90b;
            border-bottom: 1px solid #2b3139;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .answers-table td {
            padding: 20px;
            border-bottom: 1px solid #2b3139;
            font-size: 15px;
            color: #eaecef;
            vertical-align: top;
        }
        
        .answers-table tbody tr:last-child td {
            border-bottom: none;
        }
        
        .answers-table tbody tr:hover {
            background: rgba(240, 185, 11, 0.05);
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤ */
        .question-number {
            width: 60px;
            font-weight: 700;
            color: #f0b90b;
            font-size: 18px;
        }
        
        .question-text {
            color: #eaecef;
            font-weight: 500;
            line-height: 1.5;
            margin-bottom: 15px;
        }
        
        .user-answer {
            background: rgba(43, 49, 57, 0.5);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid;
            margin-bottom: 10px;
            line-height: 1.5;
        }
        
        .user-answer.correct {
            border-color: #27ae60;
            background: rgba(39, 174, 96, 0.1);
        }
        
        .user-answer.incorrect {
            border-color: #e74c3c;
            background: rgba(231, 76, 60, 0.1);
        }
        
        .user-answer.timeout {
            border-color: #f39c12;
            background: rgba(243, 156, 18, 0.1);
            font-style: italic;
            color: #f39c12;
        }
        
        .answer-info {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            color: #b7bdc6;
            margin-top: 8px;
        }
        
        .answer-time {
            color: #f0b90b;
            font-weight: 600;
        }
        
        .answer-status {
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 13px;
        }
        
        .correct-status {
            color: #27ae60;
        }
        
        .incorrect-status {
            color: #e74c3c;
        }
        
        .timeout-status {
            color: #f39c12;
        }
        
        .no-answer {
            color: #95a5a6;
            font-style: italic;
            font-size: 15px;
        }
        
        /* –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
        .control-panel {
            background: rgba(18, 22, 28, 0.95);
            padding: 20px 25px;
            border-top: 1px solid #2b3139;
        }
        
        .toggle-switch {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #2b3139;
            transition: .4s;
            border-radius: 26px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: #b7bdc6;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #f0b90b;
        }
        
        input:checked + .slider:before {
            transform: translateX(24px);
            background-color: #0b0e11;
        }
        
        .toggle-label {
            font-size: 15px;
            font-weight: 600;
            color: #eaecef;
        }
        
        .toggle-status {
            padding: 6px 12px;
            border-radius: 6px;
            font-weight: bold;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .status-active {
            background: rgba(240, 185, 11, 0.15);
            color: #f0b90b;
            border: 1px solid rgba(240, 185, 11, 0.3);
        }
        
        .status-inactive {
            background: rgba(255, 107, 107, 0.15);
            color: #ff6b6b;
            border: 1px solid rgba(255, 107, 107, 0.3);
        }
        
        .control-buttons {
            display: flex;
            gap: 12px;
            margin-top: 15px;
        }
        
        .btn {
            background: linear-gradient(135deg, #f0b90b 0%, #f8d12f 100%);
            color: #0b0e11;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 700;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(240, 185, 11, 0.25);
        }
        
        .btn:disabled {
            background: #2b3139;
            color: #5e6673;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #e74c3c 0%, #ff7979 100%);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
        }
        
        .btn-secondary {
            background: #2b3139;
            color: #eaecef;
        }
        
        .btn-secondary:hover {
            background: #3a424b;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }
        
        /* –ó–∞–≥—Ä—É–∑–∫–∞ */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #b7bdc6;
            font-size: 16px;
        }
        
        .loader {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(240, 185, 11, 0.3);
            border-radius: 50%;
            border-top-color: #f0b90b;
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .no-user-selected {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #b7bdc6;
            text-align: center;
            padding: 40px;
        }
        
        .no-user-selected .icon {
            font-size: 64px;
            margin-bottom: 20px;
            color: #f0b90b;
            opacity: 0.5;
        }
        
        .no-user-selected h3 {
            color: #f0b90b;
            margin-bottom: 15px;
            font-size: 24px;
        }
        
        /* –í–æ–ø—Ä–æ—Å—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è */
        .questions-data {
            display: none;
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 1200px) {
            .sidebar {
                width: 300px;
            }
        }
        
        @media (max-width: 900px) {
            .admin-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: 300px;
                border-right: none;
                border-bottom: 1px solid #2b3139;
            }
            
            .users-list {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 15px;
            }
            
            .user-card {
                margin-bottom: 0;
            }
        }
        
        @media (max-width: 600px) {
            .sidebar-header,
            .main-header,
            .answers-container {
                padding: 20px;
            }
            
            .answers-table th,
            .answers-table td {
                padding: 15px;
            }
            
            .user-info {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å: —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>üìä –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
                <p>–°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ‚Ä¢ 15 –≤–æ–ø—Ä–æ—Å–æ–≤</p>
            </div>
            
            <div class="sidebar-stats">
                <div class="stat-row">
                    <span class="stat-label">–í—Å–µ–≥–æ –ø—Ä–æ—à–ª–∏:</span>
                    <span class="stat-value" id="total-users">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">–°—Ä–µ–¥–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</span>
                    <span class="stat-value" id="avg-score">0%</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã–π —Ç–µ—Å—Ç:</span>
                    <span class="stat-value" id="test-status-sidebar">–ù–µ—Ç</span>
                </div>
            </div>
            
            <div class="users-list" id="users-list">
                <!-- –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                <div class="loading">
                    <div class="loader"></div>
                    –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...
                </div>
            </div>
            
            <div class="control-panel">
                <div class="toggle-switch">
                    <label class="switch">
                        <input type="checkbox" id="test-toggle">
                        <span class="slider"></span>
                    </label>
                    <span class="toggle-label">–í–∫–ª—é—á–∏—Ç—å —Ç–µ—Å—Ç</span>
                    <span id="test-status" class="toggle-status status-inactive">–í–´–ö–õ</span>
                </div>
                
                <div class="control-buttons">
                    <button class="btn btn-success" onclick="exportToCSV()" id="export-btn" disabled>
                        üì• –≠–∫—Å–ø–æ—Ä—Ç CSV
                    </button>
                    <button class="btn btn-secondary" onclick="loadData()">
                        üîÑ –û–±–Ω–æ–≤–∏—Ç—å
                    </button>
                </div>
            </div>
        </div>
        
        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å: –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <div class="main-content">
            <div class="main-header">
                <h1 id="selected-user-name">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h1>
                <div class="user-details-header" id="user-details-header" style="display: none;">
                    <div class="user-info">
                        <div class="user-detail">
                            <strong>–†–µ–∑—É–ª—å—Ç–∞—Ç:</strong> <span id="user-result-score">0/15</span>
                        </div>
                        <div class="user-detail">
                            <strong>–í—Ä–µ–º—è:</strong> <span id="user-total-time">0 —Å–µ–∫</span>
                        </div>
                        <div class="user-detail">
                            <strong>–ü—Ä–æ—Ü–µ–Ω—Ç:</strong> <span id="user-percentage">0%</span>
                        </div>
                    </div>
                    <div class="user-detail">
                        <strong>–ó–∞–≤–µ—Ä—à–µ–Ω–æ:</strong> <span id="user-completed-at">‚Äî</span>
                    </div>
                </div>
            </div>
            
            <div class="answers-container" id="answers-container">
                <div class="no-user-selected" id="no-user-selected">
                    <div class="icon">üëà</div>
                    <h3>–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
                    <p>–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Å–ø–∏—Å–∫–∞ —Å–ª–µ–≤–∞, —á—Ç–æ–±—ã –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –µ–≥–æ –æ—Ç–≤–µ—Ç—ã</p>
                </div>
                
                <!-- –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ -->
                <div id="user-details" style="display: none;">
                    <div class="answers-header">
                        <h2>–û—Ç–≤–µ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
                        <div class="answers-summary">
                            <div class="score" id="user-score-display">0/15</div>
                            <div class="score-label">–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤</div>
                        </div>
                    </div>
                    
                    <div class="answers-table">
                        <table>
                            <thead>
                                <tr>
                                    <th style="width: 80px;">‚Ññ</th>
                                    <th>–í–æ–ø—Ä–æ—Å</th>
                                    <th>–û—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</th>
                                    <th style="width: 100px;">–í—Ä–µ–º—è</th>
                                    <th style="width: 120px;">–°—Ç–∞—Ç—É—Å</th>
                                </tr>
                            </thead>
                            <tbody id="answers-body">
                                <!-- –û—Ç–≤–µ—Ç—ã –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –°–∫—Ä—ã—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å–æ–≤ -->
    <div class="questions-data" id="questions-data">
        <!-- –í–æ–ø—Ä–æ—Å—ã –±—É–¥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –∑–¥–µ—Å—å -->
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Supabase
        const SUPABASE_URL = 'https://wkukgnkfbxgpvlraczeu.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_11WBFNEcbspv1yDyfxq7sQ_Nl51ew5i';
        
        // –°–æ–∑–¥–∞–µ–º –∫–ª–∏–µ–Ω—Ç
        const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        
        // –î–∞–Ω–Ω—ã–µ –í–°–ï–• 15 –≤–æ–ø—Ä–æ—Å–æ–≤
        const QUESTIONS = [
            {
                number: 1,
                text: "–ê–Ω–∞–ª–∏—Ç–∏–∫ - —ç—Ç–æ:",
                options: {
                    option1: "–î—Ä—É–≥ –¥–µ–≤—É—à–∫–∏, –∫–æ—Ç–æ—Ä—ã–π —Ö–æ—Ä–æ—à–æ —Ä–∞–∑–±–∏—Ä–∞–µ—Ç—Å—è –≤ –∫—Ä–∏–ø—Ç–µ –∏ –≤–µ–¥–µ—Ç –∑–∞–∫—Ä—ã—Ç—ã–π –∫–∞–Ω–∞–ª —Å —Å–∏–≥–Ω–∞–ª–∞–º–∏",
                    option2: "–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∞–Ω–∞–ª–∏—Ç–∏–∫, —Ä–∞–±–æ—Ç–∞—é—â–∏–π –≤ –∫—Ä—É–ø–Ω–æ–π –∫–æ–º–ø–∞–Ω–∏–∏, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –¥–∞–µ—Ç —Å–∏–≥–Ω–∞–ª—ã –Ω–∏–∫–æ–º—É, –∫—Ä–æ–º–µ –¥–µ–≤—É—à–∫–∏ –∏ –µ–µ –æ—Ç—Ü–∞"
                },
                correct: "option2"
            },
            {
                number: 2,
                text: "–ö–æ–≥–æ –≤—ã –≤–æ–∑—å–º—ë—Ç–µ –≤ —Ä–∞–±–æ—Ç—É?",
                options: {
                    option1: "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä, 31 –≥–æ–¥, –≥—Ä–∞–∂–¥–∞–Ω—Å—Ç–≤–æ –†–§, —Ä–æ–¥–∏–ª—Å—è –≤ –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥–µ, —Ä–∞–±–æ—Ç–∞–µ—Ç –∫—É—Ä—å–µ—Ä–æ–º –≤ Ozon",
                    option2: "–ù–∞–∏–ª—å, 29 –ª–µ—Ç, –≥—Ä–∞–∂–¥–∞–Ω—Å—Ç–≤–æ –†–§, —Ä–æ–¥–∏–ª—Å—è –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ, –æ–ø—ã—Ç–Ω—ã–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –≤ —Å—Ñ–µ—Ä–µ –ø—Ä–æ–¥–∞–∂, —Ö–æ—Ä–æ—à–æ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç",
                    option3: "–ù–∏–∫–æ–≥–æ"
                },
                correct: "option1"
            },
            {
                number: 3,
                text: "–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä–Ω—ã–π –≤–±—Ä–æ—Å –¥–µ–ª–∞–µ—Ç—Å—è —Å —Ü–µ–ª—å—é:",
                options: {
                    option1: "–£–≤–∏–¥–µ—Ç—å —Ä–µ–∞–∫—Ü–∏—é –∫–ª–∏–µ–Ω—Ç–∞ –Ω–∞ —Ç–æ—Ç —Ñ–∞–∫—Ç, —á—Ç–æ –¥–µ–≤—É—à–∫–∞ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–∞ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è—Ö",
                    option2: "–†–∞—Å—Å–∫–∞–∑–∞—Ç—å –∫–ª–∏–µ–Ω—Ç—É, –∫–∞–∫ –¥–µ–≤—É—à–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–º, —á—Ç–æ–±—ã —É –∫–ª–∏–µ–Ω—Ç–∞ –±—ã–ª–æ –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Å—Ñ–µ—Ä—ã –Ω–∞ –º–æ–º–µ–Ω—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è"
                },
                correct: "option1"
            },
            {
                number: 4,
                text: "–°–∫–æ–ª—å–∫–æ –≤–±—Ä–æ—Å–æ–≤ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–∞ –≤–µ—Å—å –¥–∏–∞–ª–æ–≥?",
                options: {
                    option1: "2-3 –≤–±—Ä–æ—Å–∞",
                    option2: "1 –≤–±—Ä–æ—Å",
                    option3: "4-6 –≤–±—Ä–æ—Å–æ–≤"
                },
                correct: "option1"
            },
            {
                number: 5,
                text: "–û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ '–ø—Ä–æ–≥—Ä–µ–≤–æ–≤' –¥–æ –º–æ–º–µ–Ω—Ç–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è:",
                options: {
                    option1: "3 —Ä–∞–∑–∞",
                    option2: "1-2 —Ä–∞–∑–∞",
                    option3: "5 –∏ –±–æ–ª–µ–µ —Ä–∞–∑"
                },
                correct: "option1"
            },
            {
                number: 6,
                text: "–í–æ–∑—å–º–µ—Ç–µ –ª–∏ –≤—ã –∫–ª–∏–µ–Ω—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π —Å–∏–¥–∏—Ç –Ω–∞ —Å–∞–π—Ç–µ –∑–Ω–∞–∫–æ–º—Å—Ç–≤ –±–æ–ª—å—à–µ –º–µ—Å—è—Ü–∞, –Ω–æ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –µ–º—É –µ—â–µ –Ω–µ –ø—Ä–µ–¥–ª–∞–≥–∞–ª–∏?",
                options: {
                    option1: "–î–∞",
                    option2: "–ù–µ—Ç"
                },
                correct: "option2"
            },
            {
                number: 7,
                text: "–ö–æ–≥–¥–∞ –¥–µ–ª–∞–µ—Ç—Å—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–Ω—ã–π –≤–±—Ä–æ—Å?",
                options: {
                    option1: "–ù–∞ –≤—Ç–æ—Ä–æ–π –¥–µ–Ω—å –æ–±—â–µ–Ω–∏—è",
                    option2: "–í –ø–µ—Ä–≤—ã–π –¥–µ–Ω—å –æ–±—â–µ–Ω–∏—è, –≤ –ø–µ—Ä–≤—ã–µ 2 —á–∞—Å–∞ –≤–µ–¥–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞",
                    option3: "–ü–æ—Å–ª–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è"
                },
                correct: "option2"
            },
            {
                number: 8,
                text: "–ú–æ–∂–Ω–æ –ª–∏ –ø–µ—Ä–µ–¥–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ —Å —Ö–æ—Ä–æ—à–µ–π –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞—Ä–ø–ª–∞—Ç–æ–π, –Ω–æ —Å –ø—Ä–æ—Å—Ä–æ—á–∫–∞–º–∏ –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º?",
                options: {
                    option1: "–î–∞",
                    option2: "–ù–µ—Ç"
                },
                correct: "option2"
            },
            {
                number: 9,
                text: "–ö–ª–∏–µ–Ω—Ç—É –±—É–¥–µ—Ç 23 –≥–æ–¥–∞ —á–µ—Ä–µ–∑ –¥–≤–µ –Ω–µ–¥–µ–ª–∏, –≤–æ–∑—å–º—ë—Ç–µ –ª–∏ –≤—ã –µ–≥–æ –≤ —Ä–∞–±–æ—Ç—É?",
                options: {
                    option1: "–î–∞",
                    option2: "–ù–µ—Ç"
                },
                correct: "option2"
            },
            {
                number: 10,
                text: "–ö–æ–≥–¥–∞ –≤—ã —É–∑–Ω–∞–≤–∞–ª–∏ —É –∫–ª–∏–µ–Ω—Ç–∞ —á—Ç–æ –µ–º—É –ø—Ä–µ–¥–ª–∞–≥–∞–ª–∏, –æ–Ω —Å–∫–∞–∑–∞–ª —á—Ç–æ –µ–º—É –ø–∏—Å–∞–ª–æ –º–Ω–æ–≥–æ —Ñ–µ–π–∫–æ–≤ —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º–∏ –ø–æ—Ä–∞–±–æ—Ç–∞—Ç—å –∏ –∫—É–ø–∏—Ç—å –∏–Ω—Ç–∏–º–Ω—ã–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏. –í–æ–∑—å–º—ë—Ç–µ –ª–∏ –≤—ã —Ç–∞–∫–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –≤ —Ä–∞–±–æ—Ç—É?",
                options: {
                    option1: "–î–∞",
                    option2: "–ù–µ—Ç"
                },
                correct: "option1"
            },
            {
                number: 11,
                text: "–ö–ª–∏–µ–Ω—Ç —Ä–∞–Ω—å—à–µ –∑–∞–Ω–∏–º–∞–ª—Å—è –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è–º–∏, –Ω–æ –≥–æ–¥ –Ω–∞–∑–∞–¥ –≤—Å–µ –ø–æ—Ç–µ—Ä—è–ª. –ß—Ç–æ –≤—ã —Å–¥–µ–ª–∞–µ—Ç–µ —Å —Ç–∞–∫–∏–º –∫–ª–∏–µ–Ω—Ç–æ–º?",
                options: {
                    option1: "–í–æ–∑—å–º–µ—Ç–µ –≤ —Ä–∞–±–æ—Ç—É –ø–æ—Å–∫–æ–ª—å–∫—É —ç—Ç–æ —Ö–æ—Ä–æ—à–∏–π –∫–ª–∏–µ–Ω—Ç —É–∂–µ —Å –∏–Ω—Ç–µ—Ä–µ—Å–æ–º –∫ —Å—Ñ–µ—Ä–µ",
                    option2: "–ü—Ä–æ–∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä—É–µ—Ç–µ—Å—å —Å —Ç–∏–º–ª–∏–¥–µ—Ä–æ–º",
                    option3: "–ê—Ä—Ö–∏–≤, –ø–æ—Å–∫–æ–ª—å–∫—É —É –∫–ª–∏–µ–Ω—Ç–∞ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–π –æ–ø—ã—Ç —Å –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è–º–∏"
                },
                correct: "option2"
            },
            {
                number: 12,
                text: "–ö–∞–∫–∞—è —Ü–µ–ª—å –ø—Ä–æ–≥—Ä–µ–≤–∞?",
                options: {
                    option1: "–°–æ–∑–¥–∞—Ç—å —É –∫–ª–∏–µ–Ω—Ç–∞ –∏–Ω—Ç–µ—Ä–µ—Å –∫ —Ä–∞–∑–≤–∏—Ç–∏—é –∏ —É–≤–µ–ª–∏—á–µ–Ω–∏—é –¥–æ—Ö–æ–¥–∞",
                    option2: "–†–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø–ª—é—Å—ã —Å—Ñ–µ—Ä—ã –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π",
                    option3: "–†–∞—Å—Å–∫–∞–∑–∞—Ç—å –∫–∞–∫ –¥–µ–≤–æ—á–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–º"
                },
                correct: "option1"
            },
            {
                number: 13,
                text: "–ö–ª–∏–µ–Ω—Ç –≤ —Å–∞–º–æ–º –Ω–∞—á–∞–ª–µ –æ–±—â–µ–Ω–∏—è 5-–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º –ø—Ä–æ—Å–∏—Ç —Å–∫–∏–Ω—É—Ç—å —Ñ–æ—Ç–∫–∏. –í–∞—à–∏ –¥–µ–π—Å—Ç–≤–∏—è?",
                options: {
                    option1: "–°–∫–∏–Ω–µ—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏",
                    option2: "–°–∫–∞–∂–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç—É —á—Ç–æ –æ–Ω –ø–µ—Ä–µ–≥–∏–±–∞–µ—Ç –ø–∞–ª–∫—É –∏ –≤—ã –Ω–µ —Å–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å –∫–∏–¥–∞—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –Ω–µ –∑–Ω–∞–∫–æ–º–æ–º—É —á–µ–ª–æ–≤–µ–∫—É",
                    option3: "–ú—è–≥–∫–æ –æ—Ç–∫–∞–∂–µ—Ç–µ, –ø–æ—Å–ª–µ —á–µ–≥–æ –≤ —Ç–µ—á–µ–Ω–∏–∏ 30-60 –º–∏–Ω —Å–∞–º–∏ —Å–∫–∏–Ω–µ—Ç–µ –∫–ª–∏–µ–Ω—Ç—É –∫—Ä—É–∂–æ—á–µ–∫ –±–µ–∑ –µ–≥–æ –ø—Ä–æ—Å—å–±—ã"
                },
                correct: "option3"
            },
            {
                number: 14,
                text: "–í —Å–∞–º–æ–º –Ω–∞—á–∞–ª–µ –æ–±—â–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç –ø—Ä–æ—Å–∏—Ç —Å–∫–∏–Ω—É—Ç—å –∫—Ä—É–∂–µ–∫ —á—Ç–æ –±—ã —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –¥–µ–≤–æ—á–∫–∞ –Ω–µ —Ñ–µ–π–∫. –í–∞—à–∏ –¥–µ–π—Å—Ç–≤–∏—è?",
                options: {
                    option1: "–°–∫–∏–Ω–µ—Ç–µ –∫—Ä—É–∂–µ—á–µ–∫, —Ç–µ–º —Å–∞–º—ã–º –æ—Ç—Å–µ–µ—Ç–µ —É –Ω–µ–≥–æ –≤—Å–µ —Å–æ–º–Ω–µ–Ω–∏—è –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ –æ–±—â–µ–Ω–∏–µ",
                    option2: "–í—ã–∫–∏–Ω–µ—Ç–µ –≤ –∞—Ä—Ö–∏–≤"
                },
                correct: "option2"
            },
            {
                number: 15,
                text: "–í—ã–±–µ—Ä–µ—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ",
                options: {
                    option1: "–ê–Ω–∞–ª–∏—Ç–∏–∫ –Ω–∞–±–∏—Ä–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ –∏ –≤–æ–∑—å–º–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞ –µ—Å–ª–∏ —É –Ω–µ–≥–æ –±—É–¥–µ—Ç –∂–µ–ª–∞–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–∞—Ç—å –∏ —Ö–æ—Ä–æ—à–∏–π –∫–∞–ø–∏—Ç–∞–ª",
                    option2: "–ê–Ω–∞–ª–∏—Ç–∏–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–∞—Å—Ç–Ω—ã–º —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–º –≤ –±–æ–ª—å—à–æ–π –∫–æ–º–ø–∞–Ω–∏–∏ –∏ –≤–æ–∑—å–º–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞ –≤ –ø–∞—Ä—Ç–Ω–µ—Ä—ã —Ä–∞–¥–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –ø–æ—Ç–æ–º—É —á—Ç–æ –∑–∞ –Ω–µ–≥–æ –ø–æ–ø—Ä–æ—Å–∏–ª–∞ –¥–µ–≤–æ—á–∫–∞"
                },
                correct: "option2"
            }
        ];
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        let allUsers = [];
        let selectedUser = null;
        let realtimeSubscription = null;
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
            await loadData();
            await loadSettings();
            setupRealtime();
        });
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        async function loadData() {
            console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...');
            showLoading(true);
            
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                const { data: users, error } = await supabaseClient
                    .from('test_sessions')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                    throw error;
                }
                
                console.log('–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã:', users?.length || 0, '–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π');
                
                allUsers = users || [];
                updateStats();
                renderUsersList();
                
                showLoading(false);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ' + error.message);
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ç–µ—Å—Ç–∞
        async function loadSettings() {
            try {
                const { data: settings, error } = await supabaseClient
                    .from('test_settings')
                    .select('*')
                    .single();
                
                if (error) throw error;
                
                const toggle = document.getElementById('test-toggle');
                const statusSpan = document.getElementById('test-status');
                const sidebarStatus = document.getElementById('test-status-sidebar');
                
                toggle.checked = settings.is_active;
                if (settings.is_active) {
                    statusSpan.textContent = '–í–ö–õ';
                    statusSpan.className = 'toggle-status status-active';
                    sidebarStatus.textContent = '–î–∞';
                } else {
                    statusSpan.textContent = '–í–´–ö–õ';
                    statusSpan.className = 'toggle-status status-inactive';
                    sidebarStatus.textContent = '–ù–µ—Ç';
                }
                
                // –°–æ–±—ã—Ç–∏–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
                toggle.addEventListener('change', async () => {
                    const newStatus = toggle.checked;
                    
                    const { error } = await supabaseClient
                        .from('test_settings')
                        .update({ is_active: newStatus })
                        .eq('id', 1);
                    
                    if (error) {
                        console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫:', error);
                        alert('–û—à–∏–±–∫–∞: ' + error.message);
                        toggle.checked = !newStatus;
                    } else {
                        statusSpan.textContent = newStatus ? '–í–ö–õ' : '–í–´–ö–õ';
                        statusSpan.className = newStatus ? 
                            'toggle-status status-active' : 
                            'toggle-status status-inactive';
                        sidebarStatus.textContent = newStatus ? '–î–∞' : '–ù–µ—Ç';
                    }
                });
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫:', error);
            }
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ realtime –ø–æ–¥–ø–∏—Å–∫–∏
        function setupRealtime() {
            if (realtimeSubscription) {
                supabaseClient.removeChannel(realtimeSubscription);
            }
            
            realtimeSubscription = supabaseClient
                .channel('test_results_changes')
                .on('postgres_changes', 
                    { 
                        event: '*', 
                        schema: 'public', 
                        table: 'test_sessions' 
                    }, 
                    (payload) => {
                        console.log('Realtime: –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö');
                        loadData();
                    }
                )
                .on('postgres_changes',
                    { 
                        event: '*', 
                        schema: 'public', 
                        table: 'test_settings' 
                    },
                    (payload) => {
                        console.log('Realtime: –∏–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫');
                        loadSettings();
                    }
                )
                .subscribe();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            // –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            document.getElementById('total-users').textContent = allUsers.length;
            
            // –°—Ä–µ–¥–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (15 –≤–æ–ø—Ä–æ—Å–æ–≤)
            const completedUsers = allUsers.filter(u => u.status === 'completed');
            if (completedUsers.length > 0) {
                const avgCorrect = completedUsers.reduce((sum, u) => sum + (u.total_correct || 0), 0) / completedUsers.length;
                const avgPercent = Math.round((avgCorrect / 15) * 100);
                document.getElementById('avg-score').textContent = avgPercent + '%';
            } else {
                document.getElementById('avg-score').textContent = '0%';
            }
            
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É —ç–∫—Å–ø–æ—Ä—Ç–∞ –µ—Å–ª–∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ
            document.getElementById('export-btn').disabled = allUsers.length === 0;
        }
        
        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        function renderUsersList() {
            const usersList = document.getElementById('users-list');
            
            if (allUsers.length === 0) {
                usersList.innerHTML = `
                    <div class="no-user-selected" style="height: auto; padding: 40px 20px;">
                        <div class="icon">üì≠</div>
                        <h3>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</h3>
                        <p>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –µ—â–µ –Ω–µ –ø—Ä–æ—à–ª–∏ —Ç–µ—Å—Ç</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            allUsers.forEach((user, index) => {
                const totalCorrect = user.total_correct || 0;
                const percentage = Math.round((totalCorrect / 15) * 100);
                const isActive = selectedUser && selectedUser.id === user.id;
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–≤–µ—Ç –æ—Ü–µ–Ω–∫–∏
                let scoreClass = '';
                if (percentage >= 75) scoreClass = 'correct';
                else if (percentage >= 50) scoreClass = '';
                else scoreClass = 'incorrect';
                
                // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É
                const date = new Date(user.created_at);
                const dateString = date.toLocaleDateString('ru-RU');
                const timeString = date.toLocaleTimeString('ru-RU').slice(0, 5);
                
                html += `
                    <div class="user-card ${isActive ? 'active' : ''}" 
                         onclick="selectUser('${user.id}')"
                         id="user-card-${user.id}">
                        <div class="user-header">
                            <div class="user-nickname" title="${user.telegram_nickname || '–ë–µ–∑ –∏–º–µ–Ω–∏'}">
                                ${user.telegram_nickname || '–ë–µ–∑ –∏–º–µ–Ω–∏'}
                            </div>
                            <div class="user-score ${scoreClass}">
                                ${totalCorrect}/15
                            </div>
                        </div>
                        <div class="user-meta">
                            <div>${dateString} ${timeString}</div>
                            <div class="user-status status-${user.status || 'completed'}">
                                ${getStatusText(user.status)}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            usersList.innerHTML = html;
        }
        
        // –í—ã–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function selectUser(userId) {
            const user = allUsers.find(u => u.id === userId);
            if (!user) return;
            
            selectedUser = user;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–∞—Ä—Ç–æ—á–∫—É
            document.querySelectorAll('.user-card').forEach(card => {
                card.classList.remove('active');
            });
            document.getElementById(`user-card-${userId}`).classList.add('active');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
            showUserDetails(user);
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
        function showUserDetails(user) {
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
            document.getElementById('selected-user-name').textContent = 
                `–û—Ç–≤–µ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${user.telegram_nickname || '–ë–µ–∑ –∏–º–µ–Ω–∏'}`;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–ª–æ–∫ —Å –¥–µ—Ç–∞–ª—è–º–∏
            document.getElementById('user-details-header').style.display = 'flex';
            document.getElementById('no-user-selected').style.display = 'none';
            document.getElementById('user-details').style.display = 'block';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É (15 –≤–æ–ø—Ä–æ—Å–æ–≤)
            const totalCorrect = user.total_correct || 0;
            const percentage = Math.round((totalCorrect / 15) * 100);
            const totalTime = user.total_time_spent || 0;
            
            document.getElementById('user-result-score').textContent = `${totalCorrect}/15`;
            document.getElementById('user-total-time').textContent = `${totalTime} —Å–µ–∫`;
            document.getElementById('user-percentage').textContent = `${percentage}%`;
            document.getElementById('user-score-display').textContent = `${totalCorrect}/15`;
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
            let completedAt = '‚Äî';
            if (user.completed_at) {
                const date = new Date(user.completed_at);
                completedAt = date.toLocaleDateString('ru-RU') + ' ' + 
                             date.toLocaleTimeString('ru-RU').slice(0, 5);
            }
            document.getElementById('user-completed-at').textContent = completedAt;
            
            // –†–µ–Ω–¥–µ—Ä–∏–º –æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤—Å–µ 15 –≤–æ–ø—Ä–æ—Å–æ–≤
            renderUserAnswers(user);
        }
        
        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –æ—Ç–≤–µ—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (15 –≤–æ–ø—Ä–æ—Å–æ–≤)
        function renderUserAnswers(user) {
            const answersBody = document.getElementById('answers-body');
            let html = '';
            
            for (let i = 1; i <= 15; i++) {
                const question = QUESTIONS[i - 1];
                const answerKey = user[`q${i}_answer`];
                const isCorrect = user[`q${i}_is_correct`];
                const timeSpent = user[`q${i}_time_spent`];
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞
                let answerText = '–ù–µ—Ç –æ—Ç–≤–µ—Ç–∞';
                let answerClass = 'timeout';
                let statusText = '–¢–∞–π–º–∞—É—Ç';
                let statusClass = 'timeout-status';
                
                if (answerKey && answerKey !== 'null') {
                    answerText = question.options[answerKey] || answerKey;
                    answerClass = isCorrect ? 'correct' : 'incorrect';
                    statusText = isCorrect ? '–ü—Ä–∞–≤–∏–ª—å–Ω–æ' : '–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ';
                    statusClass = isCorrect ? 'correct-status' : 'incorrect-status';
                }
                
                html += `
                    <tr>
                        <td class="question-number">${question.number}</td>
                        <td>
                            <div class="question-text">${question.text}</div>
                            <div class="user-answer ${answerClass}">
                                ${answerText}
                                <div class="answer-info">
                                    <span class="answer-time">${timeSpent || 0} —Å–µ–∫</span>
                                    <span class="answer-status ${statusClass}">${statusText}</span>
                                </div>
                            </div>
                        </td>
                        <td>${answerText}</td>
                        <td><span class="answer-time">${timeSpent || 0} —Å–µ–∫</span></td>
                        <td><span class="answer-status ${statusClass}">${statusText}</span></td>
                    </tr>
                `;
            }
            
            answersBody.innerHTML = html;
        }
        
        // –¢–µ–∫—Å—Ç —Å—Ç–∞—Ç—É—Å–∞
        function getStatusText(status) {
            const statusMap = {
                'completed': '–ó–∞–≤–µ—Ä—à–µ–Ω',
                'in_progress': '–í –ø—Ä–æ—Ü–µ—Å—Å–µ',
                'waiting': '–û–∂–∏–¥–∞–Ω–∏–µ',
                'timeout': '–¢–∞–π–º–∞—É—Ç'
            };
            return statusMap[status] || '–ó–∞–≤–µ—Ä—à–µ–Ω';
        }
        
        // –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV (15 –≤–æ–ø—Ä–æ—Å–æ–≤)
        function exportToCSV() {
            if (allUsers.length === 0) {
                alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞');
                return;
            }
            
            const headers = ['ID', 'Telegram –Ω–∏–∫', '–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞', '–í—Å–µ–≥–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö', '–ü—Ä–æ—Ü–µ–Ω—Ç', '–û–±—â–µ–µ –≤—Ä–µ–º—è', '–°—Ç–∞—Ç—É—Å'];
            
            const csvRows = [
                headers.join(','),
                ...allUsers.map(user => {
                    const totalCorrect = user.total_correct || 0;
                    const percentage = Math.round((totalCorrect / 15) * 100);
                    const row = [
                        user.id,
                        `"${user.telegram_nickname || ''}"`,
                        user.created_at,
                        totalCorrect,
                        percentage + '%',
                        user.total_time_spent || 0,
                        user.status
                    ];
                    return row.join(',');
                })
            ];
            
            const csvString = csvRows.join('\n');
            const blob = new Blob([csvString], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            const date = new Date().toISOString().split('T')[0];
            a.download = `test_results_${date}_${allUsers.length}_users.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            console.log('CSV —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω:', allUsers.length, '–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π');
        }
        
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ UI
        function showLoading(show) {
            const usersList = document.getElementById('users-list');
            if (show) {
                usersList.innerHTML = `
                    <div class="loading" style="height: 200px;">
                        <div class="loader"></div>
                        –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...
                    </div>
                `;
            }
        }
        
        function showError(message) {
            const usersList = document.getElementById('users-list');
            usersList.innerHTML = `
                <div class="error" style="margin: 20px; padding: 20px; border-radius: 12px; background: rgba(231, 76, 60, 0.1); border: 1px solid rgba(231, 76, 60, 0.3); color: #e74c3c;">
                    <strong>–û—à–∏–±–∫–∞:</strong> ${message}<br><br>
                    <button onclick="loadData()" class="btn btn-secondary" style="padding: 8px 16px; font-size: 14px;">
                        –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É
                    </button>
                </div>
            `;
        }
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        window.exportToCSV = exportToCSV;
        window.loadData = loadData;
        window.selectUser = selectUser;
    </script>
</body>
</html>
