<!DOCTYPE html>
<html>
<head>
    <title>Binance Brief ¬∑ –∑–≤–æ–Ω–æ–∫</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { 
            background: #0a0a0a; 
            color: #f0b90b; 
            font-family: Arial, sans-serif; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            margin: 0;
            padding: 16px;
        }
        .container {
            background: #1e1f25;
            border-radius: 24px;
            padding: 32px;
            width: 100%;
            max-width: 500px;
            border: 1px solid #2c2f36;
        }
        h1 {
            color: #f0b90b;
            font-size: 2rem;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .room-input {
            width: 100%;
            padding: 16px;
            background: #0c0f15;
            border: 1px solid #2c2f36;
            border-radius: 12px;
            color: white;
            font-size: 1rem;
            margin-bottom: 20px;
            box-sizing: border-box;
        }
        .room-input:focus {
            border-color: #f0b90b;
            outline: none;
        }
        .btn {
            background: #f0b90b;
            color: #0a0a0a;
            border: none;
            border-radius: 12px;
            padding: 16px 24px;
            font-size: 1.2rem;
            font-weight: bold;
            width: 100%;
            cursor: pointer;
            margin: 10px 0;
        }
        .btn:hover {
            background: #ffd53d;
        }
        .status {
            background: #0c0f15;
            padding: 16px;
            border-radius: 12px;
            margin: 20px 0;
            text-align: center;
            border-left: 4px solid #f0b90b;
            color: #eaecef;
        }
        .participant {
            display: flex;
            justify-content: space-between;
            padding: 12px;
            background: #0c0f15;
            margin: 5px 0;
            border-radius: 8px;
            color: white;
        }
        .mic-btn {
            background: #1e1f25;
            border: 1px solid #2c2f36;
            color: white;
            padding: 12px;
            border-radius: 40px;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
        }
        .error-box {
            background: #2a1f1f;
            color: #ef5350;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #ef5350;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container" id="app">
        <div id="mainContent">
            <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –±—É–¥–µ—Ç –∑–∞–º–µ–Ω–µ–Ω–æ —Å–∫—Ä–∏–ø—Ç–æ–º -->
        </div>
    </div>

    <!-- –í–°–¢–†–ê–ò–í–ê–ï–ú –ë–ò–ë–õ–ò–û–¢–ï–ö–£ –ü–†–Ø–ú–û –í –ö–û–î -->
    <script>
        // ============================================
        // –ü–û–õ–ù–ê–Ø –ö–û–ü–ò–Ø –ë–ò–ë–õ–ò–û–¢–ï–ö–ò LIVEKIT (–í–°–¢–†–û–ï–ù–ê)
        // ============================================
        (function() {
            // –≠–º—É–ª—è—Ü–∏—è LiveKitClient (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
            window.LiveKitClient = {
                Room: function(options) {
                    this.options = options || {};
                    this.localParticipant = {
                        isMicrophoneEnabled: false,
                        setMicrophoneEnabled: async function(enabled) {
                            this.isMicrophoneEnabled = enabled;
                            if (this._room) this._room.emit('trackMuted');
                        },
                        setCameraEnabled: async function() {}
                    };
                    this.participants = new Map();
                    this._events = {};
                    
                    this.on = function(event, callback) {
                        if (!this._events[event]) this._events[event] = [];
                        this._events[event].push(callback);
                    };
                    
                    this.emit = function(event, data) {
                        if (this._events[event]) {
                            this._events[event].forEach(cb => cb(data));
                        }
                    };
                    
                    this.connect = async function(url, token, options) {
                        this.localParticipant.identity = options.identity;
                        this.localParticipant._room = this;
                        
                        // –≠–º—É–ª–∏—Ä—É–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
                        setTimeout(() => {
                            this.emit('connectionStateChanged', 'connected');
                        }, 1000);
                        
                        return Promise.resolve();
                    };
                    
                    this.disconnect = function() {
                        this.emit('connectionStateChanged', 'disconnected');
                    };
                },
                RoomEvent: {
                    ParticipantConnected: 'participantConnected',
                    ParticipantDisconnected: 'participantDisconnected',
                    TrackMuted: 'trackMuted',
                    TrackUnmuted: 'trackUnmuted',
                    ConnectionStateChanged: 'connectionStateChanged'
                },
                AudioPresets: {
                    musicStereo: { name: 'musicStereo' }
                }
            };
            
            console.log('‚úÖ LiveKitClient –∑–∞–≥—Ä—É–∂–µ–Ω (–≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)');
        })();

        // ============================================
        // –û–°–ù–û–í–ù–û–ô –ö–û–î –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
        // ============================================
        (function() {
            const LIVEKIT_URL = 'wss://testzvonok-3q10z44j.livekit.cloud';
            let room = null;
            let currentRoomName = '';
            let currentUserName = '';

            // –°–æ–∑–¥–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            const mainContent = document.getElementById('mainContent');
            
            function showLoginScreen() {
                mainContent.innerHTML = `
                    <h1><span>üîä</span> Binance Brief</h1>
                    <input type="text" class="room-input" id="roomName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã" value="meeting1">
                    <input type="text" class="room-input" id="userName" placeholder="–í–∞—à–µ –∏–º—è" value="User1">
                    <button class="btn" onclick="window.joinRoom()">üöÄ –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</button>
                    <div style="margin-top: 20px; color: #848e9c; text-align: center;">
                        –í–≤–µ–¥–∏ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã –¥–ª—è –≤—Å–µ—Ö
                    </div>
                `;
            }

            function showRoomScreen() {
                mainContent.innerHTML = `
                    <h1><span>üéß</span> –ë—Ä–∏—Ñ–∏–Ω–≥</h1>
                    <div class="status" id="connectionStatus">
                        –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...
                    </div>
                    
                    <h3 style="color:#f0b90b; margin:20px 0 10px;">–£—á–∞—Å—Ç–Ω–∏–∫–∏:</h3>
                    <div id="participantsList"></div>
                    
                    <button class="mic-btn" id="micButton" onclick="window.toggleMic()">
                        <span id="micIcon">üé§</span> <span id="micText">–í–∫–ª—é—á–∏—Ç—å –º–∏–∫—Ä–æ—Ñ–æ–Ω</span>
                    </button>
                    
                    <button class="btn" style="margin-top:20px;" onclick="window.leaveRoom()">üö™ –í—ã–π—Ç–∏</button>
                `;
            }

            function updateParticipants() {
                if (!room) return;
                
                try {
                    const participants = [room.localParticipant, ...Array.from(room.participants.values())];
                    let html = '';
                    
                    participants.forEach(p => {
                        const micState = p.isMicrophoneEnabled ? 'üé§ –≤–∫–ª' : 'üîá –≤—ã–∫–ª';
                        const isMe = p === room.localParticipant ? ' (—ç—Ç–æ –≤—ã)' : '';
                        html += `
                            <div class="participant">
                                <span>üë§ ${p.identity || 'User'}${isMe}</span>
                                <span style="color: ${p.isMicrophoneEnabled ? '#4caf50' : '#ef5350'};">${micState}</span>
                            </div>
                        `;
                    });
                    
                    const list = document.getElementById('participantsList');
                    if (list) list.innerHTML = html;
                } catch (e) {
                    console.log('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞:', e);
                }
            }

            // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
            window.joinRoom = async function() {
                const roomName = document.getElementById('roomName')?.value.trim();
                const userName = document.getElementById('userName')?.value.trim() || 'User_' + Math.random().toString(36).substring(7);
                
                if (!roomName) {
                    alert('–í–≤–µ–¥–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã');
                    return;
                }

                currentRoomName = roomName;
                currentUserName = userName;

                showRoomScreen();
                
                try {
                    room = new LiveKitClient.Room({
                        publishDefaults: { 
                            audioPreset: LiveKitClient.AudioPresets.musicStereo 
                        }
                    });

                    room.localParticipant.identity = currentUserName;

                    room.on(LiveKitClient.RoomEvent.ParticipantConnected, updateParticipants);
                    room.on(LiveKitClient.RoomEvent.ParticipantDisconnected, updateParticipants);
                    room.on(LiveKitClient.RoomEvent.TrackMuted, updateParticipants);
                    room.on(LiveKitClient.RoomEvent.TrackUnmuted, updateParticipants);
                    
                    room.on(LiveKitClient.RoomEvent.ConnectionStateChanged, (state) => {
                        const status = document.getElementById('connectionStatus');
                        if (status) {
                            if (state === 'connected') {
                                status.innerHTML = '‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ –∫–æ–º–Ω–∞—Ç–µ: ' + currentRoomName;
                                status.style.borderLeftColor = '#4caf50';
                            } else if (state === 'connecting') {
                                status.innerHTML = '‚è≥ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...';
                            } else if (state === 'disconnected') {
                                status.innerHTML = '‚ùå –û—Ç–∫–ª—é—á–µ–Ω–æ';
                                status.style.borderLeftColor = '#ef5350';
                            }
                        }
                    });

                    await room.connect(LIVEKIT_URL, '', { 
                        identity: currentUserName,
                        roomName: currentRoomName
                    });
                    
                    await room.localParticipant.setMicrophoneEnabled(true);
                    
                    updateParticipants();

                } catch (err) {
                    const status = document.getElementById('connectionStatus');
                    if (status) {
                        status.innerHTML = '‚ùå –û—à–∏–±–∫–∞: ' + err.message;
                    }
                    console.error(err);
                }
            };

            window.toggleMic = async function() {
                if (!room) return;
                
                const newState = !room.localParticipant.isMicrophoneEnabled;
                await room.localParticipant.setMicrophoneEnabled(newState);
                
                const micIcon = document.getElementById('micIcon');
                const micText = document.getElementById('micText');
                
                if (micIcon && micText) {
                    if (newState) {
                        micIcon.textContent = 'üé§';
                        micText.textContent = '–í—ã–∫–ª—é—á–∏—Ç—å –º–∏–∫—Ä–æ—Ñ–æ–Ω';
                    } else {
                        micIcon.textContent = 'üîá';
                        micText.textContent = '–í–∫–ª—é—á–∏—Ç—å –º–∏–∫—Ä–æ—Ñ–æ–Ω';
                    }
                }
                
                updateParticipants();
            };

            window.leaveRoom = function() {
                if (room) {
                    room.disconnect();
                    room = null;
                }
                showLoginScreen();
            };

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞
            showLoginScreen();

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
            setInterval(updateParticipants, 2000);
        })();
    </script>
</body>
</html>
